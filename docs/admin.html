<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>後台管理介面（雙向編輯）</title>
<script>
(function(){
  const isLocal = ['127.0.0.1','localhost'].includes(location.hostname);
  if(!isLocal){
    document.write('<div style="font-family:system-ui,\'Noto Sans TC\',Arial,sans-serif;padding:40px;text-align:center">此頁僅限本機使用。請在本機執行 <code>python server.py</code> 後以 <b>http://127.0.0.1:5000/admin.html</b> 開啟。</div>');
    document.close(); throw new Error('admin locked on public host');
  }
})();
</script>
<style>
  body{font-family:system-ui,"Noto Sans TC",Arial,sans-serif;background:#f3f5f7;margin:0;}
  .app{max-width:1100px;margin:36px auto;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.06);padding:22px 24px;}
  h1{margin:0 0 16px;display:flex;gap:10px;align-items:center;justify-content:space-between;}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0;}
  input[type="text"], input[type="date"], select, textarea{border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;font-size:15px;}
  textarea{width:100%;min-height:200px;}
  .btn{padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:#fff;cursor:pointer}
  .btn.gray{background:#6b7280}.btn.green{background:#059669}.btn.red{background:#dc2626}.btn.soft{background:#e5e7eb;color:#111827}
  .msg{padding:10px 12px;border-radius:8px;margin:8px 0;display:none}
  .msg.ok{display:block;background:#e6f9ed;color:#065f46}.msg.err{display:block;background:#fde2e0;color:#9b1c1c}
  .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;margin-top:12px;}
  .box{background:#f8fafc;border-radius:10px;padding:12px;}
  .list .item{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:8px 10px;margin:6px 0;display:flex;justify-content:space-between;align-items:center;}
  .muted{opacity:.65}
  .links a{color:#2563eb;text-decoration:none;margin-left:8px}
</style>
</head>
<body>
<div class="app">
  <h1>
    <span>後台管理介面（雙向編輯）</span>
    <div class="links">
      <a href="teacher.html">老師主頁</a>
      <a href="index.html">學生日曆</a>
    </div>
  </h1>

  <div id="msg" class="msg"></div>

  <div class="row">
    <label>學生：</label>
    <select id="studentSel"></select>
    <button class="btn" id="btnReload">載入</button>
    <span style="flex:1"></span>
    <input type="text" id="newId" placeholder="新學生 id（小寫/無空白）"/>
    <input type="text" id="newName" placeholder="新學生姓名（顯示用，可空）"/>
    <button class="btn green" id="btnAddStudent">新增學生</button>
  </div>

  <div class="grid">
    <div class="box">
      <h3>建立 / 編輯（單鍵儲存）</h3>
      <div class="row">
        <input type="date" id="date"/>
        <select id="course"></select>
        <select id="type"></select>
      </div>
      <div class="row">
        <input style="flex:1" type="text" id="title" placeholder="標題"/>
        <input style="flex:1" type="text" id="filename" placeholder="檔名（可留空，會用 日期_標題.html）"/>
      </div>
      <textarea id="html" placeholder="教材 HTML（可留空：只記錄路徑；按『儲存』會直接寫入/覆蓋）"></textarea>
      <div class="row">
        <button class="btn green" id="btnSave">儲存</button>
        <label><input type="checkbox" id="keepForm"/> 儲存後保留表單值（複製下一筆）</label>
        <button class="btn soft" id="btnClear">清空表單</button>
        <button class="btn soft" id="btnReloadHtml">重載目前教材</button>
        <span class="muted">儲存會：寫 HTML（若有內容）→ 更新/新增條目 → 寫入 manifest.json</span>
      </div>
    </div>

    <div class="box">
      <h3>現有條目</h3>
      <div class="row">
        <label>篩選日期：</label>
        <input type="date" id="filterDate"/>
        <span class="muted">刪除會**同時**刪除 HTML 檔</span>
      </div>
      <div class="list" id="list"></div>
    </div>
  </div>
</div>

<script src="admin.js"></script>
</body>
</html>
